generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Shop {
  id              Int      @id @default(autoincrement())
  abn             String   @unique
  code            String   @unique
  name            String
  phone           String
  logo            String
  address1        String   @default("")
  address2        String   @default("")
  suburb          String   @default("")
  state           String   @default("")
  postcode        String   @default("")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  creditRate      Float    @default(1.5)
  cashPointRate   Float    @default(1)
  creditPointRate Float    @default(1)
  apiKey          String   @default("")
  customerKey     String   @default("")
}

model Printer {
  id        Int     @id @default(autoincrement())
  shopId    Int
  label     String
  ip        String
  port      Int
  isMain    Boolean @default(false)
  isSplit   Boolean @default(false)
  isLabel   Boolean @default(false)
  hasDrawer Boolean @default(false)
  archived  Boolean @default(false)

  @@index([shopId])
}

model Staff {
  id         Int      @id @default(autoincrement())
  name       String
  code       String
  phone      Int      @unique
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  permission String   @default("{}")
  archived   Boolean  @default(false)
}

model Category {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  name      String
  Product   Product[]
}

model BuffetClass {
  id        Int      @id @default(autoincrement())
  mId       Int?
  name      String
  priceA    Float    @default(0)
  priceWA   Float    @default(0)
  priceB    Float    @default(0)
  priceWB   Float    @default(0)
  priceC    Float    @default(0)
  priceWC   Float    @default(0)
  nameA     String   @default("A")
  nameB     String   @default("B")
  nameC     String   @default("C")
  archived  Boolean  @default(false)
  createdAt DateTime @default(now())
}

model Product {
  id            Int       @id @default(autoincrement())
  mId           Int?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  categoryId    Int?
  category      Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  name          String
  subName       String?
  regular_price Float
  sale_price    Float
  const         Float     @default(0)
  printer       String    @default("[]")
  options       String    @default("[]") @db.Text
  buffetOnly    Boolean   @default(true)
  buffetPrice   String    @default("{}")
  bClasses      String    @default("[]")
  index         Int       @default(999)

  @@index([categoryId])
}

model CashInOut {
  id        Int      @id @default(autoincrement())
  staffName String
  cashIn    Float
  cashOut   Float
  note      String   @default("") @db.Text
  createdAt DateTime @default(now())
}

model TableContainer {
  id        Int      @id @default(autoincrement())
  index     Int      @default(999)
  name      String
  archived  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tables    Table[]
}

model Table {
  id          Int             @id @default(autoincrement())
  name        String
  index       Int
  key         String          @default("")
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  containerId Int?
  container   TableContainer? @relation(fields: [containerId], references: [id], onDelete: SetNull)
  archived    Boolean         @default(false)
}

// model DeviceToken {
//   id        Int      @id @default(autoincrement())
//   payload   String   @unique
//   device    Device   @relation(fields: [deviceId], references: [id], onDelete: Cascade)
//   deviceId  Int
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   @@index([deviceId])
// }

model Shift {
  id        Int       @id @default(autoincrement())
  openAt    DateTime  @default(now())
  closedAt  DateTime?
  updatedAt DateTime  @updatedAt
}
